
#INCLUDE <TV_PICKIT2_SHIFT_1.C>
#INCLUDE <TV_PICKIT2_SHIFT_LCD.C>

#DEFINE  UP      BT0    //DK LED DON
#DEFINE  DW      BT1
#DEFINE  ADJ     BT2
#DEFINE  MOD     BT3

SIGNED INT PHUT,GIAY,GIO, BDN;

#INT_TIMER1

VOID INTERRUPT_TIMER1()
{
   BDN++; SET_TIMER1 (3036) ;
}

VOID LCD_HIENTHI_DONGHO()
{
   LCD_GOTO_XY (0, 11) ;
   
   LCD_DATA (GIO / 10 + 0X30) ;
   LCD_DATA (GIO % 10 + 0X30) ;
   LCD_DATA (' ') ;
   LCD_DATA (PHUT / 10 + 0X30) ;
   LCD_DATA (PHUT % 10 + 0X30) ;
   LCD_DATA (' ') ;
   LCD_DATA (GIAY / 10 + 0X30) ;
   LCD_DATA (GIAY % 10 + 0X30) ;
   
   LCD_GOTO_XY(1,0);
   LCD_DATA("BT0: UP");
   LCD_GOTO_XY(1,10);
   LCD_DATA("BT1: DW");
   LCD_GOTO_XY(2,0);
   LCD_DATA("BT2: ADJ");
}

VOID MAIN()
{
   SET_UP_PORT_IC_CHOT () ;
   
   // Dem Timer
   SETUP_TIMER_1 (T1_INTERNAL|T1_DIV_BY_8) ;
   SET_TIMER1 (3036) ;
   ENABLE_INTERRUPTS (GLOBAL) ;
   ENABLE_INTERRUPTS (INT_TIMER1) ;
   GIAY = 0; BDN = 0;
   
   // Khoi tao LCD
   SETUP_LCD () ;
   LCD_GOTO_XY (0, 0) ;
   LCD_DATA ("DONG HO:") ;
   GIAY = 0;
   PHUT = 0;

   WHILE (TRUE)
   {
      LCD_HIENTHI_DONGHO () ;
      
      
      IF (BDN < 10) LCD_HIENTHI_DONGHO ();

      ELSE
      {
         BDN = BDN - 10;
         GIAY++;

         IF (GIAY == 60)
         {
            GIAY = 0;
            PHUT++;

            IF (PHUT == 60)
            {
               PHUT = 0;
               GIO++;
               IF (GIO == 24) GIO = 0;
            }
         }
      }
   }
}

